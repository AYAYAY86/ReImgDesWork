<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Hydra + p5.js Feedback Loop</title>
  <style> body { margin: 0; overflow: hidden; } </style>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.4.2/lib/p5.min.js"></script>
  <script src="https://hydra.ojack.xyz/build/hydra-synth.js"></script>
</head>
<body>
  <script>
    let hc = document.createElement('canvas')
    hc.width = window.innerWidth
    hc.height = window.innerHeight
    document.body.appendChild(hc)

    let hydra = new Hydra({ detectAudio: false, canvas: hc })
    hydra.setResolution(window.innerWidth * 2, window.innerHeight * 2)

    let pg

    // Setup Hydra feedback loop
    src(o0)
      .layer(src(s0))
      .scale(0.995)
      .modulateScale(osc(5, 0.1), 0.03)
      .out()

    function setup() {
      createCanvas(windowWidth, windowHeight)
      s0.init({ src: drawingContext.canvas }) // p5 canvas into Hydra
      pg = createGraphics(width, height)
      background(0)
    }

    function draw() {
      // draw hydra feedback into p5 graphics layer
      pg.drawingContext.drawImage(hc, 0, 0, pg.width, pg.height)

      // display that layer to screen
      image(pg, 0, 0)

      // draw text or interaction
      fill(255)
      textSize(48)
      textAlign(CENTER, CENTER)
      text('Hydra + p5.js', width / 2, height / 2)
    }
  </script>
</body>
</html>